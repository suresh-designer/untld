{"version":3,"sources":["../../../../lib/color-utils.ts"],"sourcesContent":["/**\n * Utility to extract a color palette from an image URL using the Canvas API.\n */\nexport async function extractPaletteFromImage(imageUrl: string, count: number = 5): Promise<string[]> {\n    return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.crossOrigin = \"Anonymous\"; // Crucial for cross-domain images\n\n        img.onload = () => {\n            const canvas = document.createElement('canvas');\n            const ctx = canvas.getContext('2d');\n            if (!ctx) {\n                resolve([]);\n                return;\n            }\n\n            // Small scale for faster processing\n            const scale = 50;\n            canvas.width = scale;\n            canvas.height = scale;\n\n            ctx.drawImage(img, 0, 0, scale, scale);\n\n            const imageData = ctx.getImageData(0, 0, scale, scale).data;\n            const colorCounts: { [key: string]: number } = {};\n\n            // Sample pixels\n            for (let i = 0; i < imageData.length; i += 4) {\n                const r = imageData[i];\n                const g = imageData[i + 1];\n                const b = imageData[i + 2];\n                const a = imageData[i + 3];\n\n                // Skip transparent or near-transparent pixels\n                if (a < 128) continue;\n\n                // Skip extremely dark or extremely light pixels (often background/noise)\n                const brightness = (r * 299 + g * 587 + b * 114) / 1000;\n                if (brightness < 20 || brightness > 235) continue;\n\n                // Group similar colors by rounding components\n                const factor = 10;\n                const roundedR = Math.round(r / factor) * factor;\n                const roundedG = Math.round(g / factor) * factor;\n                const roundedB = Math.round(b / factor) * factor;\n\n                const hex = rgbToHex(roundedR, roundedG, roundedB);\n                colorCounts[hex] = (colorCounts[hex] || 0) + 1;\n            }\n\n            // Sort by frequency and take top N\n            const palette = Object.entries(colorCounts)\n                .sort((a, b) => b[1] - a[1])\n                .slice(0, count)\n                .map(entry => entry[0]);\n\n            resolve(palette);\n        };\n\n        img.onerror = () => {\n            console.warn('Failed to load image for color extraction:', imageUrl);\n            resolve([]);\n        };\n\n        // Use our proxy to avoid CORS issues with external images\n        img.src = `/api/proxy-image?url=${encodeURIComponent(imageUrl)}`;\n    });\n}\n\nfunction rgbToHex(r: number, g: number, b: number): string {\n    const toHex = (n: number) => {\n        const hex = n.toString(16);\n        return hex.length === 1 ? '0' + hex : hex;\n    };\n    return `#${toHex(r)}${toHex(g)}${toHex(b)}`.toUpperCase();\n}\n"],"names":[],"mappings":"uCAGO,eAAe,EAAwB,CAAgB,CAAE,EAAgB,CAAC,EAC7E,OAAO,IAAI,QAAQ,CAAC,EAAS,KACzB,IAAM,EAAM,IAAI,MAChB,EAAI,WAAW,CAAG,YAElB,CAF+B,CAE3B,MAAM,CAAG,KACT,IAAM,EAAS,SAAS,MAHqC,OAGxB,CAAC,UAChC,EAAM,EAAO,UAAU,CAAC,MAC9B,GAAI,CAAC,EAAK,YACN,EAAQ,EAAE,EAMd,EAAO,KAAK,GAAG,CACf,EAAO,MAAM,GAAG,CAEhB,EAAI,SAAS,CAAC,EAAK,EAAG,GAAG,MAEzB,CAFgC,GAE1B,EAAY,EAAI,YAAY,CAAC,EAAG,GAAG,EAN3B,IAMyC,CAAP,GAAW,CACrD,EAAyC,CAAC,EAGhD,IAAK,IAAI,EAAI,EAAG,EAAI,EAAU,MAAM,CAAE,GAAK,EAAG,CAC1C,IAAM,EAAI,CAAS,CAAC,EAAE,CAChB,EAAI,CAAS,CAAC,EAAI,EAAE,CACpB,EAAI,CAAS,CAAC,EAAI,EAAE,CAI1B,GAHU,AAGN,CAHe,CAAC,EAAI,EAAE,CAGlB,IAAK,SAGb,IAAM,EAAa,AAAC,CAAI,MAAU,IAAJ,EAAc,IAAJ,CAAI,CAAG,CAAI,IACnD,GAAI,EAAa,IAAM,EAAa,IAAK,SAQzC,IAAM,EAAM,AAuB5B,SAvBqC,AAuB5B,AAAS,CAAS,CAAE,CAAS,CAAE,CAAS,EAC7C,GAxB2C,CAwBrC,EAAQ,AAAC,IACX,GAzBiD,CAyB3C,EAAM,EAAE,QAAQ,CAAC,IACvB,OAAO,AAAe,MAAX,MAAM,CAAS,IAAM,EAAM,CAC1C,EACA,MAAO,CAAC,CAAC,EAAE,EAAM,GAAA,EAAK,EAAM,GAAA,EAAK,EAAM,GAAA,CAAI,CAAC,WAAW,EAC3D,EAjCiC,QAAK,KAAK,CAAC,IAAI,KACf,KADyB,AACpB,KAAK,CAAC,IAAI,EACf,QADyB,AACpB,KAAK,CAAC,EAHb,EAGiB,GAGhC,CAAW,CAAC,EAAI,CAAG,CAAC,CAAW,AAHW,CAGV,EAAI,EAAI,CAAC,EAAI,CACjD,CAQA,EALgB,MAKR,CALe,OAAO,CAAC,GAC1B,IAAI,CAAC,CAAC,EAAG,IAAM,CAAC,CAAC,EAAE,CAAG,CAAC,CAAC,EAAE,EAC1B,KAAK,CAAC,EAAG,GACT,GAAG,CAAC,GAAS,CAAK,CAAC,EAAE,EAG9B,EAEA,EAAI,OAAO,CAAG,KACV,QAAQ,IAAI,CAAC,6CAA8C,GAC3D,EAAQ,EAAE,CACd,EAGA,EAAI,GAAG,CAAG,CAAC,qBAAqB,EAAE,mBAAmB,GAAA,CAAW,AACpE,EACJ"}